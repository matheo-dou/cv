name: DÃ©ploiement Statique

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout du code
        uses: actions/checkout@v4

      - name: âš™ï¸ PrÃ©paration des dossiers
        id: setup
        run: |
          # CrÃ©e le dossier saves s'il n'existe pas
          mkdir -p saves

          # DÃ©finit le nom du dossier de sauvegarde
          SAVE_DIR="saves/backup-$(date +%Y%m%d-%H%M%S)"
          echo "SAVE_DIR=$SAVE_DIR" >> $GITHUB_OUTPUT

      - name: ðŸ“¤ Sauvegarde des fichiers actuels Ã  la racine
        run: |
          SAVE_DIR="${{ steps.setup.outputs.SAVE_DIR }}"
          
          # CrÃ©e le dossier de sauvegarde horodatÃ©
          mkdir -p "$SAVE_DIR"
          
          # DÃ©place les fichiers de la racine (sauf .git, .github et saves)
          # vers le dossier de sauvegarde
          find . -maxdepth 1 \
            -not -path '*/.git*' \
            -not -path '*/.github*' \
            -not -path '*/saves*' \
            -not -path '*/.' \
            -not -path '*/..' \
            -exec mv {} "$SAVE_DIR" \;
            
      - name: ðŸ“¥ DÃ©placement des fichiers de dev vers la racine
        run: |
          # Copie tout le contenu du dossier 'dev' vers la racine du dÃ©pÃ´t
          cp -r dev/* .

      - name: ðŸ’¾ Commit et Push des changements
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Ajoute tous les changements (sauvegardes, nouveaux fichiers)
          git add .
          
          if git diff --staged --quiet; then
            echo "Pas de changements Ã  commiter."
          else
            git commit -m "ðŸ¤– Auto-dÃ©ploiement: Mise Ã  jour depuis 'dev' et sauvegarde"
            git push
          fi
          
